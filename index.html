<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>–î–∞—à—É–ª—å–∫–∏–Ω –ö–æ—Ç–æ–±–µ–≥ üíñ</title>
  <style>
    :root{
      --bg:#0f1226; --fg:#fff; --accent:#ff4fd8; --accent-2:#7cf3ff;
      --ground:#1d2147; --obstacle:#ffcf4a; --shadow:#00000055; --tile:#181b39;
      --bad:#ff5a5a; --good:#76ffb0; --vh:1vh;
      --cat-size: clamp(52px, 14vmin, 100px);
      --obs-w: clamp(22px, 5.5vmin, 34px);
      --obs-h: clamp(54px, 13vmin, 80px);
      --powerup: clamp(32px, 8.5vmin, 56px);
      --hud-font: clamp(14px, 4vmin, 18px);
      --title: clamp(22px, 6.2vmin, 36px);
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    html{ touch-action: manipulation }
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      color:var(--fg);
      background:
        radial-gradient(1200px 600px at 70% -100px, #22286300 30%, #222863 60%, #111538 100%),
        linear-gradient(180deg, #090b1d 0%, #0b0e26 100%);
      background-color:var(--bg);
      display:flex; align-items:center; justify-content:center; overflow:hidden;
      -webkit-tap-highlight-color: transparent; user-select:none;
    }

    .container{
      width:min(92vw, 980px);
      aspect-ratio:16/9;
      position:relative; border-radius:16px;
      box-shadow:0 20px 50px var(--shadow), inset 0 0 0 1px #ffffff10;
      background: linear-gradient(180deg, #0e1230 0%, #0a0d25 55%, #090c20 100%);
      overflow:hidden; touch-action:none; contain: paint;
    }
    @media (hover:none) and (pointer:coarse){
      .container{ width:100vw; height:calc(var(--vh)*100); border-radius:0; box-shadow:none }
    }

    .screen{
      position:absolute; inset:0; display:flex; flex-direction:column; gap:16px;
      align-items:center; justify-content:center; z-index:10;
      background: linear-gradient(180deg,#0a0d25c0 0,#0a0d25f0 40%, #0a0d25c0 100%);
      backdrop-filter: blur(6px); text-align:center; padding:24px;
    }
    .title{ font-size:var(--title); font-weight:800; letter-spacing:.5px }
    .subtitle{ opacity:.9; font-size:clamp(14px,3.8vmin,18px) }
    .btn{
      margin-top:10px; cursor:pointer; border:0; padding:16px 26px; border-radius:999px; font-weight:800;
      color:#0b0e26; background:linear-gradient(90deg,var(--accent) 0%, var(--accent-2) 100%);
      box-shadow:0 12px 28px #0008, inset 0 0 1px #fff6; transition:.08s transform;
      touch-action:manipulation; font-size:clamp(16px,4.5vmin,18px)
    }
    .btn:active{ transform: translateY(1px) scale(.99) }
    .hidden{ display:none !important }

    .hud{
      position:absolute; top:10px; left:10px; right:10px;
      display:flex; justify-content:space-between; align-items:center; z-index:5;
      font-size:var(--hud-font); pointer-events:none;
    }
    .pills{ display:flex; gap:10px; pointer-events:auto; }
    .pill{
      background:#ffffff18; padding:.55em .9em; border-radius:999px;
      box-shadow: inset 0 0 0 1px #ffffff24; font-variant-numeric:tabular-nums;
    }
    #pauseBtn{
      border:0; cursor:pointer; border-radius:14px; padding:.55em .8em;
      background:#ffffff18; color:#fff; font-weight:800;
      box-shadow: inset 0 0 0 1px #ffffff28; touch-action:manipulation;
      font-size:clamp(16px, 4.8vmin, 20px); pointer-events:auto;
    }
    .banner{
      position:absolute; top:60px; left:50%; transform:translateX(-50%);
      padding:.5em .9em; border-radius:12px; background:#ffffff18; box-shadow: inset 0 0 0 1px #ffffff28;
      z-index:6; white-space:nowrap; font-weight:900; letter-spacing:.4px; display:none;
      font-size:clamp(14px,4.2vmin,18px)
    }
    .banner.good{ color:var(--good) } .banner.bad{ color:var(--bad) }

    #scene{ position:absolute; inset:0; overflow:hidden }
    #sky{
      position:absolute; inset:0; opacity:.55;
      background-image:
        radial-gradient(2px 2px at 20% 20%, #fff8 30%, #fff0 31%),
        radial-gradient(1.5px 1.5px at 70% 40%, #fff6 30%, #fff0 31%),
        radial-gradient(1.2px 1.2px at 40% 70%, #fff5 30%, #fff0 31%),
        radial-gradient(1.4px 1.4px at 10% 55%, #fff7 30%, #fff0 31%);
      background-repeat:repeat; background-size:600px 300px, 500px 280px, 500px 280px, 600px 330px;
    }
    #ground{
      position:absolute; left:0; right:0; height:34%; bottom:0;
      background: repeating-linear-gradient(90deg, var(--tile) 0px, var(--tile) 26px, #121433 26px, #121433 32px);
      box-shadow: 0 -10px 30px #000a inset, 0 -1px 0 #ffffff14 inset;
    }

    .entity{ position:absolute; left:0; will-change:transform }
    #cat{
      width:var(--cat-size); height:var(--cat-size);
      left:14%; bottom:34%; display:grid; place-items:center; user-select:none;
      text-shadow: 0 3px 0 #0006, 0 0 10px #0008; font-size:calc(var(--cat-size) * .78);
      filter: drop-shadow(0 10px 10px var(--shadow));
    }
    #cat.run{ animation:run-bob .25s infinite linear }
    @keyframes run-bob { 0%,100%{ transform:translateY(0)} 50%{ transform:translateY(1.6px)} }

    .obstacle{
      width:var(--obs-w); height:var(--obs-h); bottom:34%; border-radius:8px;
      background: linear-gradient(180deg,#ffe391 0%, var(--obstacle) 60%, #f3b929 100%);
      box-shadow: 0 10px 14px var(--shadow), inset 0 0 0 1px #0002;
    }

    .powerup{
      width:var(--powerup); height:var(--powerup); bottom:calc(34% + 12px);
      display:grid; place-items:center; font-size:calc(var(--powerup) * .8);
      filter: drop-shadow(0 8px 8px var(--shadow));
    }
    .powerup.fish{ text-shadow:0 0 6px #74ffd2,0 0 12px #74ffd2; animation:fishGlow 1.2s ease-in-out infinite }
    .powerup.choco{ text-shadow:0 0 6px #ff8b8b,0 0 12px #ff8b8b; animation:chocoBlink .8s linear infinite }
    @keyframes fishGlow{ 0%,100%{opacity:1;filter:drop-shadow(0 8px 8px rgba(116,255,210,.45))} 50%{opacity:.9;filter:drop-shadow(0 8px 12px rgba(116,255,210,.75))}}
    @keyframes chocoBlink{ 0%,100%{opacity:1} 50%{opacity:.65} }

    .overlay{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; z-index:9 }
    .card{
      padding:18px 20px; border-radius:14px; text-align:center;
      background:#0c102eec; box-shadow: 0 10px 40px #000a, inset 0 0 0 1px #ffffff14;
      min-width:min(70%, 520px)
    }
    .card h2{ margin-bottom:6px } .card p{ opacity:.85 }
    .card .row{ display:flex; gap:12px; justify-content:center; margin-top:14px }
    .kbd{ font-variant:all-small-caps; letter-spacing:.4px; font-weight:800; background:#ffffff14; padding:6px 10px; border-radius:8px; box-shadow: inset 0 0 0 1px #ffffff18 }

    .jump-zone{ position:absolute; inset:0; z-index:4; background:transparent }
  </style>
</head>
<body>
  <main class="container" aria-label="–ò–≥—Ä–∞: –∫–æ—Ç–∏–∫-–ø—Ä—ã–≥—É–Ω">
    <div class="hud">
      <div class="pills">
        <div class="pill">–û—á–∫–∏: <b id="score">0</b></div>
        <div class="pill">–†–µ–∫–æ—Ä–¥: <b id="best">0</b></div>
      </div>
      <button id="pauseBtn" title="–ü–∞—É–∑–∞ (P)">‚è∏</button>
    </div>
    <div id="banner" class="banner"></div>

    <div id="scene" role="application" aria-live="polite">
      <div id="sky"></div>
      <div id="ground"></div>
      <div id="cat" class="entity run" aria-label="–ö–æ—Ç–∏–∫">üê±</div>
      <div id="jumpZone" class="jump-zone" aria-hidden="true"></div>
    </div>

    <section id="start" class="screen">
      <div>
        <div class="title">–ö–æ—Ç–æ–±–µ–≥ üêæ</div>
        <p class="subtitle">–ü–æ–¥–±–µ—Ä–∏ üêü ‚Äî —Å—É–ø–µ—Ä—Å–∫–æ—Ä–æ—Å—Ç—å –∏ –±—ã—Å—Ç—Ä—ã–µ –æ—á–∫–∏. –ò–∑–±–µ–≥–∞–π üç´ ‚Äî –±—É–¥–µ—Ç —Å–ª–æ–∂–Ω–µ–µ!</p>
        <button id="playBtn" class="btn">–ò–≥—Ä–∞—Ç—å</button>
      </div>
    </section>

    <div id="gameOver" class="overlay hidden">
      <div class="card">
        <h2>–û—Ö! –ö–æ—Ç–∏–∫ —Å–ø–æ—Ç–∫–Ω—É–ª—Å—è‚Ä¶</h2>
        <p>–û—á–∫–∏: <b id="finalScore">0</b> ‚Ä¢ –†–µ–∫–æ—Ä–¥: <b id="finalBest">0</b></p>
        <div class="row">
          <button id="againBtn" class="btn">–°—ã–≥—Ä–∞—Ç—å –µ—â—ë</button>
        </div>
      </div>
    </div>
  </main>

  <script>
    // --- iOS 100vh —Ñ–∏–∫—Å ---
    function setVh(){ const vh = window.innerHeight*0.01; document.documentElement.style.setProperty('--vh', `${vh}px`); }
    setVh(); addEventListener('resize', setVh); addEventListener('orientationchange', setVh);

    // --- –ë–∞–ª–∞–Ω—Å ---
    const CONFIG = {
      baseSpeed: 250, speedPerPoint: 0.30,
      gravity: 3000,
      jumpVelocity: 810,
      fallGravityMul: 1.55,
      coyoteTime: 0.18,
      jumpBuffer: 0.22,
      nearGroundHeight: 56,
      nearGroundPull: 1.34,

      // –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–∏ –æ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏
      gravityScaleMin: 0.9,
      gravityScaleMax: 1.8,
      gravitySpeedExp: 1.0,

      minObstacleGap: 280, maxObstacleGap: 560,
      scorePerSecond: 3.45, obstacleBonus: 8, collisionPad: 6,
      fishDuration: 1.5, fishSpeedMul: 1.6, fishScoreMul: 2.0,
      chocoDuration: 3.0, chocoSpeedMul: 1.35, chocoGapMul: 0.65,
      fishEveryMinMax: [5.5*1.1, 11*1.1],
      chocoEveryMinMax: [13.2*1.1, 22*1.1]
    };

    // --- DOM ---
    const scene = document.getElementById('scene');
    const sky = document.getElementById('sky');
    const ground = document.getElementById('ground');
    const cat = document.getElementById('cat');
    const scoreEl = document.getElementById('score');
    const bestEl = document.getElementById('best');
    const pauseBtn = document.getElementById('pauseBtn');
    const banner = document.getElementById('banner');
    const jumpZone = document.getElementById('jumpZone');
    const startScreen = document.getElementById('start');
    const playBtn = document.getElementById('playBtn');
    const over = document.getElementById('gameOver');
    const finalScoreEl = document.getElementById('finalScore');
    const finalBestEl = document.getElementById('finalBest');
    const againBtn = document.getElementById('againBtn');

    // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ ---
    let obstacles=[], powerups=[];
    let running=false, paused=false, raf=0, last=0;
    let catY=0, vy=0;
    let onGround=true, timeSinceGrounded=0, timeSinceJumpPressed=999;
    let scoreFloat=0, score=0;
    let best=parseInt(localStorage.getItem('cat_best')||'0',10); bestEl.textContent=best;
    let pxPerSec=CONFIG.baseSpeed, spawnAtX=0, worldX=0;
    let t=0, fishUntil=0, chocoUntil=0;
    const rand=(a,b)=>a+Math.random()*(b-a);
    let nextFishAt=0, nextChocoAt=0;

    // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ ---
    function setBanner(text,kind='good'){ banner.textContent=text; banner.className='banner '+(kind==='bad'?'bad':'good'); banner.style.display='block'; }
    function hideBanner(){ banner.style.display='none'; }
    const isFish=()=> t<fishUntil, isChoco=()=> t<chocoUntil;
    function randomGap(){ let base=CONFIG.minObstacleGap+Math.random()*(CONFIG.maxObstacleGap-CONFIG.minObstacleGap); const speedFactor=pxPerSec/CONFIG.baseSpeed; base/=speedFactor; if(isChoco()) base*=CONFIG.chocoGapMul; return base; }

    function resetGame(){
      obstacles.forEach(o=>o.el.remove()); powerups.forEach(p=>p.el.remove());
      obstacles=[]; powerups=[];
      catY=0; vy=0; onGround=true; timeSinceGrounded=0; timeSinceJumpPressed=999;
      cat.style.transform='translate(0,0)'; cat.classList.add('run');

      scoreFloat=0; score=0; scoreEl.textContent='0';
      pxPerSec=CONFIG.baseSpeed; worldX=0; t=0; fishUntil=0; chocoUntil=0; hideBanner();

      spawnAtX=randomGap(); nextFishAt=rand(...CONFIG.fishEveryMinMax); nextChocoAt=rand(...CONFIG.chocoEveryMinMax);
      over.classList.add('hidden');
    }

    function spawnObstacle(){
      const el=document.createElement('div'); el.className='entity obstacle'; scene.appendChild(el);
      const startX=scene.clientWidth; const obj={el, x:startX, w:el.offsetWidth, h:el.offsetHeight};
      el.style.transform=`translateX(${startX}px)`; obstacles.push(obj);
    }
    function spawnPowerup(type){
      const el=document.createElement('div'); el.className=`entity powerup ${type}`; el.textContent=(type==='fish')?'üêü':'üç´'; scene.appendChild(el);
      const startX=scene.clientWidth; const obj={el, x:startX, w:el.offsetWidth, h:el.offsetHeight, type};
      el.style.transform=`translateX(${startX}px)`; powerups.push(obj);
    }

    function startGame(){
      startScreen.classList.add('hidden');
      resetGame();
      setBanner('–£–¥–∞—á–∫–∏, –î–∞—à—É–ª–∏–∫!','good');
      setTimeout(hideBanner, 1500);

      running=true; paused=false; pauseBtn.textContent='‚è∏';
      last=performance.now(); raf=requestAnimationFrame(loop);
    }
    function setPause(state){ if(!running)return; paused=state??!paused; pauseBtn.textContent=paused?'‚ñ∂':'‚è∏'; if(!paused){ last=performance.now(); raf=requestAnimationFrame(loop);} }
    function gameOver(){ running=false; paused=false; cat.classList.remove('run'); vy=0; hideBanner(); if(score>best){ best=score; localStorage.setItem('cat_best',String(best)); } finalScoreEl.textContent=score; finalBestEl.textContent=best; over.classList.remove('hidden'); }

    function loop(now){ const dt=Math.min(0.032,(now-last)/1000); last=now; if(paused||!running) return; update(dt); if(!paused&&running) raf=requestAnimationFrame(loop); }

    function update(dt){
      t+=dt;
      timeSinceGrounded += dt;
      timeSinceJumpPressed += dt;

      let speedMul=1, scoreMul=1; if(isFish()){ speedMul*=CONFIG.fishSpeedMul; scoreMul*=CONFIG.fishScoreMul; } if(isChoco()){ speedMul*=CONFIG.chocoSpeedMul; }
      pxPerSec=(CONFIG.baseSpeed+CONFIG.speedPerPoint*score)*speedMul;

      worldX+=pxPerSec*dt;
      sky.style.backgroundPositionX=`-${worldX*.15}px, -${worldX*.21}px, -${worldX*.12}px, -${worldX*.18}px`;
      ground.style.backgroundPositionX=`-${worldX*.9}px`;

      // --- –§–∏–∑–∏–∫–∞
      const falling = vy < 0;

      // –ú–∞—Å—à—Ç–∞–± –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–∏ –æ—Ç —Ç–µ–∫—É—â–µ–π –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ –∫–æ—Ç–∏–∫–∞
      const speedScaleRaw = pxPerSec / CONFIG.baseSpeed;
      const speedScale = Math.max(
        CONFIG.gravityScaleMin,
        Math.min(CONFIG.gravityScaleMax, Math.pow(speedScaleRaw, CONFIG.gravitySpeedExp))
      );

      // –ë–∞–∑–æ–≤–∞—è –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è —Å —É—á—ë—Ç–æ–º —Ñ–∞–∑—ã (–ø–∞–¥–µ–Ω–∏–µ/–≤–∑–ª—ë—Ç) –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏
      let g = CONFIG.gravity * speedScale * (falling ? CONFIG.fallGravityMul : 1);

      // ¬´–ú–∞–≥–Ω–∏—Ç¬ª –∫ –∑–µ–º–ª–µ ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Ñ–∞–∑–∞ –ø–∞–¥–µ–Ω–∏—è –±—ã—Å—Ç—Ä–µ–µ
      if (falling && catY < CONFIG.nearGroundHeight) {
        g *= CONFIG.nearGroundPull;
      }

      vy -= g * dt;
      catY = catY + vy * dt;

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞ —Å –∑–µ–º–ª—ë–π ‚Äî –í–ê–ñ–ù–û
      if (catY <= 0) {
        catY = 0;
        if (vy < 0) vy = 0;
        if (!onGround) {
          onGround = true;
          cat.classList.add('run');
        }
        timeSinceGrounded = 0;
      } else {
        onGround = false;
      }

      // –í—ã–ø–æ–ª–Ω–∏—Ç—å –±—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π/–∫–æ–π–æ—Ç-–¥–∂–∞–º–ø
      const canCoyote = timeSinceGrounded <= CONFIG.coyoteTime;
      const hasBuffered = timeSinceJumpPressed <= CONFIG.jumpBuffer;
      if((onGround || canCoyote) && hasBuffered){
        doJump();
      }

      cat.style.transform = `translate(0px, ${-catY}px)`;

      // –°–ø–∞–≤–Ω –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
      if(worldX>=spawnAtX){ if(!isFish()) spawnObstacle(); spawnAtX=worldX+randomGap(); }

      const catBox=getBox(cat, CONFIG.collisionPad);

      for(let i=obstacles.length-1;i>=0;i--){
        const o=obstacles[i];
        o.x-=pxPerSec*dt; o.el.style.transform=`translateX(${o.x}px)`;

        if(isFish()){
          const catFrontX=getEntityX(cat);
          if(o.x+o.w>catFrontX){ o.el.remove(); obstacles.splice(i,1); continue; }
        }

        if(o.x+o.w<-20){
          o.el.remove(); obstacles.splice(i,1);
          scoreFloat+=CONFIG.obstacleBonus*scoreMul;
        }else{
          const obox=getBoxFrom(o.el, CONFIG.collisionPad);
          if(intersects(catBox, obox)){ gameOver(); return; }
        }
      }

      for(let i=powerups.length-1;i>=0;i--){
        const p=powerups[i]; p.x-=pxPerSec*dt; p.el.style.transform=`translateX(${p.x}px)`;
        if(p.x+p.w<-20){ p.el.remove(); powerups.splice(i,1); continue; }
        const pbox=getBoxFrom(p.el,4);
        if(intersects(catBox,pbox)){
          if(p.type==='fish'){
            fishUntil=t+CONFIG.fishDuration; setBanner('üêü –°—É–ø–µ—Ä-—Ä—ã–±–∫–∞! –°–∫–æ—Ä–æ—Å—Ç—å –∏ –æ—á–∫–∏ ‚Üë','good');
            const catFrontX=getEntityX(cat);
            obstacles=obstacles.filter(o=>{ if(o.x+o.w>catFrontX){ o.el.remove(); return false } return true });
          }else{
            chocoUntil=t+CONFIG.chocoDuration; setBanner('–ö–û–¢–ò–ö–ê–ú –ù–ï–õ–¨–ó–Ø –®–û–ö–û–õ–ê–î!!!!!','bad');
          }
          p.el.remove(); powerups.splice(i,1); continue;
        }
      }

      scoreFloat+=CONFIG.scorePerSecond*dt*scoreMul;
      const newScore=Math.floor(scoreFloat); if(newScore!==score){ score=newScore; scoreEl.textContent=score; bestEl.textContent=best; }

      if(t>=nextFishAt){ spawnPowerup('fish'); nextFishAt=t+rand(...CONFIG.fishEveryMinMax); }
      if(t>=nextChocoAt){ spawnPowerup('choco'); nextChocoAt=t+rand(...CONFIG.chocoEveryMinMax); }
    }

    // –ì–µ–æ–º–µ—Ç—Ä–∏—è
    function getBox(el,pad=0){ const r=el.getBoundingClientRect(), s=scene.getBoundingClientRect(); return {x:r.left-s.left+pad,y:r.top-s.top+pad,w:r.width-pad*2,h:r.height-pad*2}; }
    function getBoxFrom(el,pad=0){ const r=el.getBoundingClientRect(), s=scene.getBoundingClientRect(); return {x:r.left-s.left+pad,y:r.top-s.top+pad,w:r.width-pad*2,h:r.height-pad*2}; }
    function getEntityX(el){ const r=el.getBoundingClientRect(), s=scene.getBoundingClientRect(); return r.left-s.left; }
    function intersects(a,b){ return !(a.x+a.w<b.x||b.x+b.w<a.x||a.y+a.h<b.y||b.y+b.h<a.y); }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    function requestJump(){
      if(!running || paused) return;
      timeSinceJumpPressed = 0; // –æ—Ç–º–µ—Ç–∏—Ç—å –Ω–∞–∂–∞—Ç–∏–µ ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –≤ update()
      if(onGround){ doJump(); } // –µ—Å–ª–∏ —Å—Ç–æ–∏–º –Ω–∞ –∑–µ–º–ª–µ ‚Äî –ø—Ä—ã–≥–Ω–µ–º –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
    }
    function doJump(){
      vy = CONFIG.jumpVelocity;
      cat.classList.remove('run');
      onGround = false;
      timeSinceJumpPressed = 999; // –∏–∑—Ä–∞—Å—Ö–æ–¥–æ–≤–∞–ª–∏ –±—É—Ñ–µ—Ä
    }

    document.addEventListener('keydown',e=>{
      if(e.code==='Space'||e.code==='KeyW'||e.code==='ArrowUp'){ e.preventDefault(); requestJump(); }
      else if(e.code==='KeyP'||e.code==='Escape'){ setPause(); }
    });
    const jumpEv=e=>{ e.preventDefault&&e.preventDefault(); requestJump(); };
    jumpZone.addEventListener('pointerdown', jumpEv, {passive:false});
    scene.addEventListener('pointerdown', jumpEv, {passive:false});
    jumpZone.addEventListener('touchstart', jumpEv, {passive:false});
    scene.addEventListener('touchstart', jumpEv, {passive:false});
    jumpZone.addEventListener('click', jumpEv, {passive:false});
    scene.addEventListener('click', jumpEv, {passive:false});

    pauseBtn.addEventListener('click', ()=>setPause());
    playBtn.addEventListener('click', startGame);
    againBtn.addEventListener('click', ()=>{ resetGame(); running=true; paused=false; pauseBtn.textContent='‚è∏'; last=performance.now(); raf=requestAnimationFrame(loop); });

    // –†–µ—Å–∞–π–∑
    let resizeTimer=0;
    addEventListener('resize', ()=>{ clearTimeout(resizeTimer); resizeTimer=setTimeout(()=>{
      obstacles.forEach(o=>{ o.w=o.el.offsetWidth; o.h=o.el.offsetHeight; o.el.style.transform=`translateX(${o.x}px)`; });
      powerups.forEach(p=>{ p.w=p.el.offsetWidth; p.h=p.el.offsetHeight; p.el.style.transform=`translateX(${p.x}px)`; });
    },120);});
  </script>
</body>
</html>
